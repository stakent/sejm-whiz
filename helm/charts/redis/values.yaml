# Redis configuration for sejm-whiz
redis:
  # Redis server configuration
  image:
    repository: redis
    tag: "7.2-alpine"
    pullPolicy: IfNotPresent

  # Resource limits
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # Persistence configuration
  persistence:
    enabled: true
    size: 5Gi
    storageClass: "local-path"
    accessMode: ReadWriteOnce

  # Redis configuration
  config:
    # Memory management
    maxmemory: "256mb"
    maxmemory_policy: "allkeys-lru"

    # Persistence settings
    save: "900 1 300 10 60 10000"  # RDB snapshots
    appendonly: "yes"              # AOF persistence
    appendfsync: "everysec"        # AOF sync frequency

    # Security
    requirepass: "redis_password"

    # Performance
    timeout: 300
    tcp_keepalive: 60

    # Job queue specific settings
    hash_max_ziplist_entries: 512
    hash_max_ziplist_value: 64
    list_max_ziplist_size: -2
    list_compress_depth: 0

# Service configuration
service:
  type: ClusterIP
  port: 6379
  targetPort: 6379

# Health checks
healthCheck:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 999
  fsGroup: 999

# Pod disruption budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1

# Node selection
nodeSelector: {}
tolerations: []
affinity: {}

# Monitoring
metrics:
  enabled: false
  serviceMonitor:
    enabled: false
